version: '3.8'
services:
  listener_base:
    &listener_base
    build: 
      context: .
      dockerfile: Dockerfile
      args:
        ENVIRONMENT: dev
        SERVICE: listener
      target: final-listener
    logging:
      driver: "json-file"
      options:
        max-buffer-size: "4m"
        mode: "non-blocking"
    environment:
      LISTENER_DISCORD_TOKEN: "${LISTENER_DISCORD_TOKEN:-example}"
      CONFIGURATOR_API_URL: "http://configurator_web:8000"
    command: sh -c "exit"
  listener_app:
    <<: *listener_base
    command: python3 -m listener
